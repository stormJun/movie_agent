# Router-Worker é‡æ„å¿«é€Ÿå¼€å§‹æŒ‡å—

> 5åˆ†é’Ÿå¿«é€Ÿç†è§£é‡æ„æ¶æ„å¹¶å¼€å§‹å¼€å‘
> é€‚åˆ:æ–°åŠ å…¥çš„å¼€å‘è€…ã€éœ€è¦å¿«é€Ÿä¸Šæ‰‹çš„åŒå­¦

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ(3åˆ†é’Ÿè¯»å®Œ)

### é‡æ„åšäº†ä»€ä¹ˆ?

**ä¹‹å‰**: è·¯ç”±é€»è¾‘æ•£è½åœ¨handlerä¸­,éš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•

```python
# è€ä»£ç (ä¼ªä»£ç )
def chat_handler(message, kb_prefix):
    if not kb_prefix:
        if "ç”µå½±" in message:
            kb_prefix = "movie"
        elif "å­¦ç”Ÿ" in message:
            kb_prefix = "edu"
        else:
            kb_prefix = call_llm_to_classify(message)

    agent = get_agent(agent_type, kb_prefix, session_id)
    answer = agent.ask(message)
    return answer
```

**ç°åœ¨**: åˆ†å±‚æ¶æ„,èŒè´£æ¸…æ™°

```python
# æ–°æ¶æ„(ä¼ªä»£ç )
def chat_handler(message, kb_prefix):
    # 1. è·¯ç”±å±‚:å†³å®šç”¨å“ªä¸ªKB
    decision = router.route(message, requested_kb=kb_prefix)

    # 2. ä¸šåŠ¡ç¼–æ’å±‚:å†³å®šç”¨å“ªäº›ç­–ç•¥
    kb_handler = kb_factory.get(decision.kb_prefix)
    plan = kb_handler.build_plan(message, agent_type)

    # 3. RAGæ‰§è¡Œå±‚:å¹¶è¡Œæ‰§è¡Œ+èšåˆ
    answer = rag_manager.execute(plan, message, kb_prefix)
    return answer
```

### å››å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. è·¯ç”±å±‚           â”‚  å†³å®šç”¨movieè¿˜æ˜¯edu
â”‚  RouterGraph        â”‚  (å¯å‘å¼è§„åˆ™ or LLMåˆ†ç±»)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ä¸šåŠ¡ç¼–æ’å±‚       â”‚  å†³å®šæ˜¯å¦fanout(å¹¶è¡Œå¤šä¸ªAgent)
â”‚  KnowledgeBaseHandlerâ”‚  Movie: æ¨èç±»é—®é¢˜â†’fanout
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Edu: ä¸fanout
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. RAGæ‰§è¡Œå±‚        â”‚  å¹¶è¡Œæ‰§è¡Œ + èšåˆ + ç»Ÿä¸€ç”Ÿæˆç­”æ¡ˆ
â”‚  RagManager         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æ£€ç´¢å±‚           â”‚  Agentåªè´Ÿè´£æ£€ç´¢(retrieve_only)
â”‚  graphrag_agent     â”‚  ä¸ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹(2åˆ†é’Ÿè·‘èµ·æ¥)

### 1. æ£€æŸ¥é…ç½®

```bash
# ç¡®ä¿ .env ä¸­æœ‰ä»¥ä¸‹é…ç½®
cat .env

# å¿…éœ€é…ç½®:
OPENAI_API_KEY=sk-xxx
NEO4J_URI=neo4j://localhost:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=your_password

# è·¯ç”±é…ç½®(æ¨èå€¼):
KB_AUTO_ROUTE=True                    # å¯ç”¨è‡ªåŠ¨è·¯ç”±
KB_AUTO_ROUTE_OVERRIDE=True           # å…è®¸è¦†ç›–ç”¨æˆ·é€‰æ‹©
KB_AUTO_ROUTE_MIN_CONFIDENCE=0.7      # è¦†ç›–çš„æœ€ä½ç½®ä¿¡åº¦

# Phase2é…ç½®(å½“å‰å…³é—­,æµ‹è¯•åå¯ç”¨):
RAG_ENABLE_KB_HANDLERS=False          # Phase2å¼€å…³
```

### 2. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯
bash scripts/dev.sh backend

# æˆ–å¯åŠ¨å‰ç«¯(å¯é€‰)
streamlit run frontend/app.py
```

### 3. æµ‹è¯•è·¯ç”±åŠŸèƒ½

```bash
# æµ‹è¯•1: è‡ªåŠ¨è·¯ç”±åˆ°movie
curl -X POST http://localhost:8000/api/v1/chat \
  -H "Content-Type: backend/application/json" \
  -d '{
    "message": "æ¨èä¸€äº›ç§‘å¹»ç”µå½±",
    "session_id": "test_001",
    "debug": true
  }'

# æ£€æŸ¥è¿”å›çš„route_decision:
# {
#   "kb_prefix": "movie",
#   "method": "heuristic",
#   "confidence": 0.95
# }

# æµ‹è¯•2: è‡ªåŠ¨è·¯ç”±åˆ°edu
curl -X POST http://localhost:8000/api/v1/chat \
  -H "Content-Type: backend/application/json" \
  -d '{
    "message": "æ—·è¯¾å¤šå°‘å­¦æ—¶ä¼šè¢«é€€å­¦ï¼Ÿ",
    "session_id": "test_002",
    "debug": true
  }'

# æ£€æŸ¥è¿”å›çš„route_decision:
# {
#   "kb_prefix": "edu",
#   "method": "heuristic",
#   "confidence": 0.95
# }

# æµ‹è¯•3: è¦†ç›–ç­–ç•¥(æ•…æ„ä¼ é”™kb_prefix)
curl -X POST http://localhost:8000/api/v1/chat \
  -H "Content-Type: backend/application/json" \
  -d '{
    "message": "é€€å­¦æ€ä¹ˆåŠï¼Ÿ",
    "kb_prefix": "movie",
    "session_id": "test_003",
    "debug": true
  }'

# åº”è¯¥çœ‹åˆ°:
# {
#   "route_decision": {
#     "requested_kb_prefix": "movie",
#     "kb_prefix": "edu",  // è¢«è¦†ç›–
#     "confidence": 0.95
#   }
# }
```

---

## ğŸ’» å¼€å‘ä»»åŠ¡é€ŸæŸ¥

### ä»»åŠ¡1: æ·»åŠ æ–°çš„å¯å‘å¼è§„åˆ™

**åœºæ™¯**: movieçš„å…³é”®è¯ä¸å¤Ÿå…¨,éœ€è¦è¡¥å……

**æ–‡ä»¶**: `backend/infrastructure/routing/kb_router/heuristics.py`

```python
# åœ¨MOVIE_KEYWORDSä¸­æ·»åŠ æ–°å…³é”®è¯
MOVIE_KEYWORDS = [
    "ç”µå½±", "å¯¼æ¼”", "æ¼”å‘˜", "ä¸»æ¼”", "é…è§’", "ç¥¨æˆ¿",
    "å‰§æƒ…", "æ¨è", "å½±è¯„", "ç‰‡å",
    # æ–°å¢:
    "ä¸Šæ˜ ", "é¢„å‘Šç‰‡", "å½±é™¢", "è§‚å½±", "ç”µå½±èŠ‚",
]
```

**éªŒè¯**:
```bash
python -m pytest test/unit/test_router_graph.py::TestRouterGraph::test_heuristic_routes_movie_keywords
```

### ä»»åŠ¡2: è°ƒæ•´MovieHandlerçš„fanoutç­–ç•¥

**åœºæ™¯**: æƒ³è®©"å¯¹æ¯”ç±»"é—®é¢˜ä¹Ÿfanout

**æ–‡ä»¶**: `backend/application/handlers/movie/handler.py`

```python
class MovieHandler(KnowledgeBaseHandler):
    def build_plan(self, *, message: str, agent_type: str) -> list[RagRunSpec]:
        # åŸæœ‰é€»è¾‘
        if any(k in message for k in ["æ¨è", "Top", "æœ‰å“ªäº›"]):
            return self._fanout_plan()

        # æ–°å¢: å¯¹æ¯”ç±»é—®é¢˜ä¹Ÿfanout
        if any(k in message for k in ["å¯¹æ¯”", "æ¯”è¾ƒ", "åŒºåˆ«"]):
            return self._fanout_plan()

        return [RagRunSpec(agent_type=agent_type, timeout_s=30.0)]

    def _fanout_plan(self) -> list[RagRunSpec]:
        return [
            RagRunSpec(agent_type="hybrid_agent", timeout_s=25.0),
            RagRunSpec(agent_type="graph_agent", timeout_s=25.0),
            RagRunSpec(agent_type="naive_rag_agent", timeout_s=25.0),
        ]
```

**å¯ç”¨Phase2**:
```bash
export RAG_ENABLE_KB_HANDLERS=True
# é‡å¯æœåŠ¡
bash scripts/dev.sh backend
```

### ä»»åŠ¡3: ä¸ºæ–°Agentå®ç°retrieve_onlyæ¨¡å¼

**åœºæ™¯**: ä½ å†™äº†ä¸€ä¸ªæ–°çš„`CustomAgent`,è¦æ”¯æŒPhase2çš„ç»Ÿä¸€ç”Ÿæˆ

**æ–‡ä»¶**: `backend/graphrag_agent/agents/custom_agent.py`

```python
from graphrag_agent.agents.base import BaseAgent

class CustomAgent(BaseAgent):
    def retrieve_with_trace(
        self,
        query: str,
        thread_id: Optional[str] = None
    ) -> dict[str, Any]:
        """
        retrieve_onlyæ¨¡å¼:åªæ£€ç´¢,ä¸ç”Ÿæˆç­”æ¡ˆ
        """
        if self.agent_mode == "retrieve_only":
            # 1. è°ƒç”¨ä½ çš„æ£€ç´¢å·¥å…·(åªæ£€ç´¢,ä¸ç”Ÿæˆ)
            results = self.custom_search_tool.retrieve_only(query)

            # 2. æ„é€ è¿”å›æ ¼å¼(å¿…é¡»åŒ…å«è¿™äº›å­—æ®µ)
            return {
                "context": results["evidence_text"],  # å¯è¯»çš„è¯æ®æ–‡æœ¬
                "retrieval_results": results["structured_results"],  # ç»“æ„åŒ–æ£€ç´¢ç»“æœ
                "reference": {  # å¼•ç”¨ä¿¡æ¯
                    "chunks": results["chunks"],
                    "entities": results["entities"],
                    "relationships": results["relationships"],
                },
                "execution_log": results.get("log", []),  # debugæ—¥å¿—
            }
        else:
            # legacyæ¨¡å¼:å®Œæ•´çš„æ£€ç´¢+ç”Ÿæˆ
            return self.ask_with_trace(query, thread_id)
```

**æ³¨å†Œåˆ°RagManager**:
```python
# backend/infrastructure/agents/rag_factory/manager.py

def get_agent(self, agent_type: str, ...):
    if agent_type == "custom_agent":
        from graphrag_agent.agents.custom_agent import CustomAgent
        return CustomAgent(...)
```

### ä»»åŠ¡4: è°ƒè¯•KBéš”ç¦»é—®é¢˜

**åœºæ™¯**: æ€€ç–‘movieå’Œeduæ•°æ®ä¸²åº“äº†

**æ£€æŸ¥æ¸…å•**:

```bash
# 1. æ£€æŸ¥Neo4jèŠ‚ç‚¹IDå‰ç¼€
cypher-shell -u neo4j -p your_password

# æŸ¥çœ‹movieå®ä½“
MATCH (e:__Entity__)
WHERE e.id STARTS WITH "movie:"
RETURN e.id LIMIT 5;

# æŸ¥çœ‹eduå®ä½“
MATCH (e:__Entity__)
WHERE e.id STARTS WITH "edu:"
RETURN e.id LIMIT 5;

# 2. æ£€æŸ¥å‘é‡ç´¢å¼•
SHOW INDEXES;
# åº”è¯¥çœ‹åˆ°: movie_vector, movie_chunk_vector, edu_vector, edu_chunk_vector

# 3. æ£€æŸ¥Agentå®ä¾‹çš„kb_prefix
# åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—
# backend/graphrag_agent/agents/base.py
logger.info(f"Agent created with kb_prefix={self.kb_prefix}")

# 4. æ£€æŸ¥Toolçš„ç´¢å¼•åç§°
# backend/graphrag_agent/search/tool/hybrid_tool.py
logger.info(f"HybridSearchTool using entity_index={self.entity_vector_index_name}")
# åº”è¯¥è¾“å‡º: movie_vector æˆ– edu_vector
```

---

## ğŸ“š å¸¸ç”¨æ–‡ä»¶è·¯å¾„

### è·¯ç”±ç›¸å…³

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ |
|------|---------|
| RouterGraph | `backend/infrastructure/routing/orchestrator/router_graph.py` |
| å¯å‘å¼è§„åˆ™ | `backend/infrastructure/routing/kb_router/heuristics.py` |
| LLMå…œåº• | `backend/infrastructure/routing/kb_router/router.py` |
| è·¯ç”±é…ç½® | `backend/infrastructure/config/settings.py` (KB_AUTO_ROUTE*) |

### RAGæ‰§è¡Œç›¸å…³

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ |
|------|---------|
| RagManager | `backend/infrastructure/rag/rag_manager.py` |
| èšåˆå™¨ | `backend/infrastructure/rag/aggregator.py` |
| ç­”æ¡ˆç”Ÿæˆ | `backend/infrastructure/rag/answer_generator.py` |
| MovieHandler | `backend/application/handlers/movie/handler.py` |
| EduHandler | `backend/application/handlers/edu/handler.py` |

### Agentç›¸å…³

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ |
|------|---------|
| BaseAgent | `backend/graphrag_agent/agents/base.py` |
| HybridAgent | `backend/graphrag_agent/agents/hybrid_agent.py` |
| Agentå·¥å‚ | `backend/infrastructure/agents/rag_factory/manager.py` |

### APIå…¥å£

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ |
|------|---------|
| éæµå¼API | `backend/server/api/rest/v1/chat.py` |
| æµå¼API | `backend/server/api/rest/v1/chat_stream.py` |
| StreamHandler | `backend/application/chat/handlers/stream_handler.py` |

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹å®Œæ•´çš„execution_log

```python
# åœ¨ä»»ä½•è¯·æ±‚ä¸­æ·»åŠ  debug=true
curl -X POST http://localhost:8000/api/v1/chat \
  -d '{
    "message": "ä½ çš„é—®é¢˜",
    "debug": true
  }' | jq '.execution_log'

# è¾“å‡ºç¤ºä¾‹:
# [
#   {
#     "node": "kb_route",
#     "input": {"message": "æ¨èç§‘å¹»ç”µå½±"},
#     "output": {"kb_prefix": "movie", "confidence": 0.95},
#     "duration_ms": 5.2
#   },
#   {
#     "node": "rag_execution",
#     "plan_size": 3,
#     "duration_ms": 2500
#   }
# ]
```

### 2. å•æ­¥è°ƒè¯•RouterGraph

```python
# test/debug/test_router.py

from infrastructure.routing.orchestrator import invoke_router_graph

# ç›´æ¥è°ƒç”¨RouterGraph
decision = invoke_router_graph(
    message="ä½ çš„é—®é¢˜",
    session_id="debug",
    agent_type="hybrid_agent",
    requested_kb_prefix="",
)

print(f"KB: {decision.kb_prefix}")
print(f"Method: {decision.method}")
print(f"Confidence: {decision.confidence}")
print(f"Worker: {decision.worker_name}")
```

### 3. æŸ¥çœ‹Agentå®ä¾‹æ± çŠ¶æ€

```python
# backend/infrastructure/agents/rag_factory/manager.py

# æ·»åŠ ä¸€ä¸ªhelperæ–¹æ³•
class AgentManager:
    def debug_cache_status(self):
        """æ‰“å°å½“å‰ç¼“å­˜çš„Agentå®ä¾‹"""
        print(f"Cached agents: {len(self._agent_cache)}")
        for key in self._agent_cache.keys():
            print(f"  - {key}")

# åœ¨ä½ çš„æµ‹è¯•ä»£ç ä¸­
from infrastructure.agents.rag_factory import rag_agent_manager
rag_agent_manager.debug_cache_status()
```

### 4. æµ‹è¯•èšåˆå™¨å»é‡

```python
# test/debug/test_aggregator.py

from infrastructure.rag.aggregator import aggregate_run_results
from infrastructure.rag.specs import RagRunResult

# æ¨¡æ‹Ÿ2ä¸ªAgentè¿”å›ç›¸åŒçš„chunk
results = [
    RagRunResult(
        agent_type="hybrid_agent",
        answer="",
        retrieval_results=[
            {"metadata": {"source_id": "movie:chunk_001"}, "score": 0.9},
            {"metadata": {"source_id": "movie:chunk_002"}, "score": 0.8},
        ]
    ),
    RagRunResult(
        agent_type="graph_agent",
        answer="",
        retrieval_results=[
            {"metadata": {"source_id": "movie:chunk_001"}, "score": 0.85},  # é‡å¤
            {"metadata": {"source_id": "movie:chunk_003"}, "score": 0.7},
        ]
    ),
]

aggregated = aggregate_run_results(results)
print(f"Before dedup: 4 results")
print(f"After dedup: {len(aggregated.retrieval_results)} results")
# æœŸæœ›è¾“å‡º: 3 results (chunk_001åªä¿ç•™scoreæœ€é«˜çš„)
```

---

## âš¡ æ€§èƒ½æ£€æŸ¥æ¸…å•

### å¯åŠ¨æ—¶æ£€æŸ¥

```bash
# 1. æ£€æŸ¥Neo4jè¿æ¥
cypher-shell -u neo4j -p your_password "RETURN 1"

# 2. æ£€æŸ¥å‘é‡ç´¢å¼•å­˜åœ¨
cypher-shell -u neo4j -p your_password "SHOW INDEXES"

# 3. é¢„çƒ­Agentå®ä¾‹æ± (å¯é€‰)
# åœ¨backend/server/main.pyä¸­æ·»åŠ :
@app.on_event("startup")
async def startup():
    from infrastructure.agents.rag_factory import rag_agent_manager
    rag_agent_manager.warmup(["movie", "edu"], ["hybrid_agent"])
```

### è¿è¡Œæ—¶ç›‘æ§

```bash
# æŸ¥çœ‹è¯·æ±‚å»¶è¿Ÿåˆ†å¸ƒ
tail -f logs/app.log | grep "route_decision"

# æŸ¥çœ‹fanoutæ‰§è¡Œæƒ…å†µ
tail -f logs/app.log | grep "rag_execution" | grep "fanout:true"

# æŸ¥çœ‹Agenté”™è¯¯
tail -f logs/app.log | grep "agent_retrieve" | grep "error"
```

---

## ğŸ“– ä¸‹ä¸€æ­¥å­¦ä¹ 

### åŸºç¡€ç†è§£(å·²å®Œæˆâœ…)

- [x] ç†è§£å››å±‚æ¶æ„
- [x] çŸ¥é“å¦‚ä½•å¯åŠ¨å’Œæµ‹è¯•
- [x] äº†è§£å¸¸ç”¨æ–‡ä»¶è·¯å¾„

### æ·±å…¥å­¦ä¹ (æ¨èé¡ºåº)

1. **é˜…è¯»ä¸»æ–‡æ¡£** (15åˆ†é’Ÿ)
   - [LangGraph-Router-Worker-é‡æ„è¿›åº¦.md](./LangGraph-Router-Worker-é‡æ„è¿›åº¦.md)
   - é‡ç‚¹çœ‹:ç¬¬1-5ç« (å·²è½åœ°åŠŸèƒ½)

2. **é˜…è¯»è¡¥å……è¯´æ˜** (20åˆ†é’Ÿ)
   - [é‡æ„è¡¥å……è¯´æ˜.md](./é‡æ„è¡¥å……è¯´æ˜.md)
   - é‡ç‚¹çœ‹:ç»„ä»¶äº¤äº’å›¾ã€æµ‹è¯•ç­–ç•¥

3. **åŠ¨æ‰‹å®è·µ** (1å°æ—¶)
   - ä»»åŠ¡1: æ·»åŠ ä¸€ä¸ªæ–°çš„å¯å‘å¼å…³é”®è¯
   - ä»»åŠ¡2: è°ƒæ•´MovieHandlerçš„fanoutç­–ç•¥
   - ä»»åŠ¡3: ä¸ºä¸€ä¸ªAgentå®ç°retrieve_onlyæ¨¡å¼

4. **æ·±å…¥ç†è§£** (2å°æ—¶)
   - é˜…è¯»RouterGraphæºç 
   - é˜…è¯»RagManageræºç 
   - ç†è§£Agentå®ä¾‹æ± çš„ç¼“å­˜ç­–ç•¥

### è¿›é˜¶ä¸»é¢˜

- **Phase2å®Œæ•´æµ‹è¯•**: å¯ç”¨`RAG_ENABLE_KB_HANDLERS`,æµ‹è¯•fanoutåŠŸèƒ½
- **èšåˆå™¨ä¼˜åŒ–**: å®ç°æ™ºèƒ½å»é‡å’Œsynthesizeæ¨¡å¼
- **ç›‘æ§é›†æˆ**: æ·»åŠ PrometheusæŒ‡æ ‡åŸ‹ç‚¹
- **Phase3è®¾è®¡**: ç†è§£LangGraphå…¨é“¾è·¯streaming

---

## ğŸ†˜ é‡åˆ°é—®é¢˜?

### å¸¸è§é”™è¯¯

**é”™è¯¯1**: `ModuleNotFoundError: No module named 'infrastructure'`

```bash
# è§£å†³: ç¡®ä¿å®‰è£…äº†é¡¹ç›®ä¾èµ–
pip install -e .
```

**é”™è¯¯2**: `Neo4jè¿æ¥å¤±è´¥`

```bash
# è§£å†³: æ£€æŸ¥Neo4jæ˜¯å¦å¯åŠ¨
docker ps | grep neo4j
# å¦‚æœæ²¡å¯åŠ¨:
docker compose up -d
```

**é”™è¯¯3**: `LLMè°ƒç”¨è¶…æ—¶`

```bash
# è§£å†³: æ£€æŸ¥API Keyå’Œç½‘ç»œ
curl -H "Authorization: Bearer $OPENAI_API_KEY" \
  https://api.openai.com/v1/models
```

**é”™è¯¯4**: `KBéš”ç¦»å¤±æ•ˆ,movieæ•°æ®å‡ºç°åœ¨eduæŸ¥è¯¢ä¸­`

```bash
# è§£å†³æ­¥éª¤è§ä¸Šé¢"ä»»åŠ¡4: è°ƒè¯•KBéš”ç¦»é—®é¢˜"
```

### è·å–å¸®åŠ©

1. **æŸ¥çœ‹æ—¥å¿—**: `tail -f logs/app.log`
2. **æœç´¢æ–‡æ¡£**: åœ¨ä¸»æ–‡æ¡£ä¸­æœç´¢å…³é”®è¯
3. **æŸ¥çœ‹æµ‹è¯•ç”¨ä¾‹**: `test/unit/` å’Œ `test/integration/`
4. **æIssue**: æè¿°é—®é¢˜+è´´æ—¥å¿—+è´´é…ç½®

---

## ğŸ“‹ å¿«é€Ÿå‘½ä»¤å¤‡å¿˜

```bash
# å¯åŠ¨æœåŠ¡
bash scripts/dev.sh backend

# è¿è¡Œæµ‹è¯•
python -m pytest test/unit/ -v                    # å•å…ƒæµ‹è¯•
python -m pytest test/integration/ -v             # é›†æˆæµ‹è¯•

# æµ‹è¯•è·¯ç”±(movie)
curl -X POST http://localhost:8000/api/v1/chat \
  -d '{"message":"æ¨èç§‘å¹»ç”µå½±","debug":true}'

# æµ‹è¯•è·¯ç”±(edu)
curl -X POST http://localhost:8000/api/v1/chat \
  -d '{"message":"é€€å­¦æ€ä¹ˆåŠï¼Ÿ","debug":true}'

# æŸ¥çœ‹é…ç½®
cat .env | grep KB_AUTO_ROUTE

# å¯ç”¨Phase2
export RAG_ENABLE_KB_HANDLERS=True

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/app.log

# Neo4jæŸ¥è¯¢
cypher-shell -u neo4j -p your_password
```

---

**å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å§!** ğŸ‰

å»ºè®®ä»"ä»»åŠ¡1: æ·»åŠ æ–°çš„å¯å‘å¼è§„åˆ™"å¼€å§‹,è¿™æ˜¯æœ€ç®€å•çš„å…¥é—¨ä»»åŠ¡ã€‚
