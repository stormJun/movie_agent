# 记忆中心 (Memory Center) 标准化产品设计

**版本**: 1.1.4.2-revised
**状态**: ✅ 已定稿 (基于 Phase 1-3 实现)
**日期**: 2026-01-25

---

## 1. 产品愿景

**“让 AI 不仅仅是一个聊天机器人，而是你的专属数字伙伴。”**

标准化的记忆产品不仅仅是“存储历史记录”，而是构建一个**可感知、可解释、可控制**的数字大脑。旨在解决 AI 使用中的核心痛点：
1. **失忆感**：用户需要反复重复背景信息。
2. **黑盒焦虑**：用户不知道 AI 记住了什么敏感信息。
3. **控制缺失**：用户无法修正 AI 的错误认知（如“我不再喜欢科幻片了”）。

我们的目标是打造行业标杆级的**记忆中心 (Memory Center)**。

---

## 2. 核心产品价值

| 维度 | 价值主张 | 具体体现 |
|------|---------|---------|
| **透明性 (Transparency)** | “我知道你记住了什么” | 清晰展示 AI 提取的用户画像、偏好和关键事实。 |
| **控制权 (Control)** | “我能决定你记住什么” | 支持逐条删除记忆、修改偏好、一键遗忘。 |
| **连贯性 (Continuity)** | “你记得我们上次聊的” | 跨越数月甚至数年的对话上下文自动接续。 |
| **安全性 (Privacy)** | “我的记忆只属于我” | 记忆数据严格隔离，提供彻底的物理删除能力。 |

---

## 3. 用户旅程 (The User Journey - Movie Edition)

我们将从“影迷的记忆生命周期”出发，打造专属的观影伙伴体验：

### 3.1 观影DNA的形成 (Formation)
> **用户故事**：“我告诉它我喜欢诺兰的烧脑片，它下次推荐时真的记住了。”

**产品设计**：
- **Taste Profile (观影偏好)**：当 AI 识别到你对 *Christopher Nolan* 或 *Sci-Fi* 的偏好时，侧边栏 **“我的画像”** 会自动点亮一个标签。
- **显性确认**：UI 弹出微提示：“已记录你的导演偏好：诺兰”。
- **价值**：不再是冷冰冰的问答机器，而是一个懂你口味的 **"资深影迷朋友"**。

### 3.2 观影历史的沉淀 (Consolidation) -> "The Previously On..."
> **用户故事**：“像追剧一样，每次回来它都能帮我无缝衔接。”

**产品设计**：
- **"Previously On..." (前情提要)**：借用美剧经典片头概念。
    - **舍弃**: 不直接展示枯燥的纯文本摘要。
    - **采用**: 生成一张 **Episode Card**，包含海报（如《盗梦空间》）+ 一句神总结（"上次我们在讨论多重梦境的可行性"）。
- **Watchlist (想看清单)**：
    - **MVP**：支持手动维护（在记忆中心里添加/删除），并对“推荐/想看/加入待看”等对话做保守的自动捕获（可一键删除误抓条目）。
    - **后续**：升级为更高准确率的自动捕获（基于实体识别/知识库/更强抽取链路），并支持“标记已看/不想看/去重合并”等管理能力。
- **价值**：将碎片化的对话，组织成连续的 **"观影连续剧"**。

### 3.3 经典瞬间的唤醒 (Recall) -> "Flashback"
> **用户故事**：“不仅是搜索，更是灵感迸发。”

**产品设计**：
- **Flashback Toast (闪回)**：
    - **舍弃**: 机械地列出所有相关历史。
    - **采用**: 仅在**高度相关**时触发一个微动效（如胶片转动）。点击后展示："这让你想起了 2 个月前聊过的《星际穿越》..."
- **Contextual Recommendation (基于这辈子的推荐)**：推荐理由不再是生硬的数据，而是你的**人生阅历**（"因为你在 2024 年真的很迷赛博朋克..."）。
- **价值**：创造 **"Aha! Moment"**，感受 AI 的陪伴感。

### 3.4 融合策略 (Product Fusion Strategy)

| 层次 | 技术来源 | 影迷视角 (Movie Metaphor) | 触发时机 | 融合体验 |
|------|---------|-------------------------|---------|---------|
| **L1 基座** | Phase 1 (Summarization) | **观影履历** | 每次推荐前 | "考虑到我们已阅览过 Top 250..." |
| **L2 在场** | Phase 2 (Episodic) | **经典台词/桥段** | 聊到相似剧情 | "这让我想起你上次提到的《教父》..." |
| **L3 人设** | Mem0 (Personal) | **口味DNA** | 偏好变更时 | 始终避雷恐怖片，首推科幻片。 |

---

## 4. 详细 UX/UI 设计规范

### 4.1 记忆中心仪表盘 (Dashboard)

**入口**：Chat 页面右上角“🎬 观影记忆”图标。

**布局**：
1.  **口味海报 (Taste Poster)**：
    *   将用户的观影偏好生成一张动态海报（如：赛博朋克风），展示关键词 "Sci-Fi", "Noir", "Hans Zimmer"。
2.  **核心记忆流**：
    *   🎬 2024.01.20 记录偏好：喜欢 *IMAX*
    *   🍿 2024.01.15 标记已看：《沙丘2》
    *   👎 2023.12.10 避雷：不喜欢 Jump Scare 恐怖片

### 4.2 设置与隐私控制

**剧透保护 (Spoiler Mode)**：
*   **开关**：记忆设置中增加“剧透保护”。
*   **逻辑**：若记忆中包含某部电影的结局讨论，AI 在新对话中会主动模糊处理，防止剧透。

---

## 9. 记忆微创新 (Micro-Features that Delight)

我们利用现有技术，但通过产品包装，将“技术特性”转化为“情感功能”：

### 9.1 防剧透护盾 (The Spoiler Shield)
- **痛点**：记忆力太好，容易随口把《第六感》的结局说出来。
- **设计**：AI 在检索记忆时，若发现某部电影在 User Profile 中未标记为 "Watched"，则自动触发 **Spoiler Shield**，模糊处理关键剧情。
- **体验**：用户感到被“贴心保护”。

### 9.2 观影心情日历 (Mood Calendar)
- **技术底层**：Phase 1 Summaries 的情感分析 + 时间戳。
- **设计**：一个可视化的日历热力图。
    - 周五晚上：🔥 动作/爽片
    - 周日午后：☕️ 文艺/剧情
- **体验**：AI 比你更懂你的“观影生物钟”。

### 9.3 "台词胶囊" (Quote Capsule)
- **技术底层**：Phase 2 Episodic 的语义提取。
- **设计**：当用户在对话中引用或大赞某句台词时，AI 自动将其封装为一枚“胶囊”存入记忆。
- **体验**：日后聊天时，AI 恰到好处地抛出你喜欢的这句台词，击中灵魂。

---

## 10. MVP 交付清单 (Minimum Viable Product - Executable)

根据现有技术栈（Phase 1-3），我们需要一个**绝对可落地**的最小版本。

### 10.1 前端功能 (Frontend)
- [ ] **入口**：Chat 页面顶部导航栏增加 **"胶片" (Film Strip)** 图标。
- [ ] **记忆面板 (Memory Drawer)**：点击图标从右侧滑出面板（复用现有的 Drawer 组件）。
    - **区域 A - 前情提要 ("Previously On...")**：
        - 展示最近一次生成的 conversation_summary (纯文本即可，优于无)。
    - **区域 B - 口味 DNA (Taste DNA)**：
        - 调用 mem0 接口获取所有记忆点。
        - 前端过滤/渲染为标签云 (Tags)。
        - **交互**：点击标签 -> 弹出 "Delete" 确认框。
- [ ] **交互微调**：
    - Chat 界面不做复杂改动，**不通过右键菜单**交互（开发成本高）。
    - 依靠 "Memory Drawer" 集中管理。

### 10.2 后端能力 (Backend)
- [ ] **API**: `GET /api/v1/memory/dashboard` (聚合接口：一次性拉取 Summary + Mem0 Tags)。
- [ ] **API**: `DELETE /api/v1/memory/items/{id}` (删除指定的 mem0 记录)。
- [ ] **Prompt 优化**：调整 Summarizer Prompt，强制其生成包含电影隐喻的摘要（如使用 "观众"、"剧集" 等词汇）。

### 10.3 舍弃/延后 (Post-MVP)
- [ ] 🚫 **复杂的防剧透逻辑** (逻辑太绕，MVP 暂不做)。
- [ ] 🚫 **右键点击电影名遗忘** (前端富文本交互太重)。
- [ ] 🚫 **可视化图谱** (图表库引入太重)。


我们不再堆砌技术名词，而是从“记忆的全生命周期”出发，设计用户体验：

### 3.1 记忆的形成 (Formation)
> **用户故事**：“我告诉 AI 我不吃辣，它真的听进去了吗？”

**产品设计**：
- **显性确认**：当 AI 识别到关键偏好（如饮食、职业）时，侧边栏的“我的画像”板块会出现微动效，提示“已记录新画像”。
- **透明展示**：在“我的画像”列表中，用户能立刻看到新增条目：“用户强调不吃辣 (来源：刚刚的对话)”。
- **价值**：打破“对牛弹琴”的无力感，建立“被倾听”的信任。

### 3.2 记忆的沉淀 (Consolidation)
> **用户故事**：“聊了这么久，它还记得我们最初在聊什么吗？”

**产品设计**：
- **实时摘要**：对话流顶部始终悬浮一个“当前话题摘要”，告诉用户 AI 脑子里的当前上下文状态。
- **自动归档**：当话题结束或隔天再聊时，侧边栏的“对话资产”会自动生成一份精简的日报：“昨天我们深入讨论了 Rust 的内存安全问题”。
- **价值**：消除“断片感”，让长程对话像老友重逢一样自然接续。

### 3.3 记忆的唤醒 (Recall)
> **用户故事**：“哎，就像我上次提到的那家店...”

**产品设计**：
- **闪回提示 (Flashback Toast)**：当用户触发模糊回忆时，聊天气泡旁会出现一个精致的“闪回”图标。
- **点击交互**：用户点击图标，会展开一个小卡片：“想起 3 个月前的对话：‘外婆家 (西湖店)’”。
- **价值**：创造 **"Wow Moment"**。这不是简单的搜索，而是像人类一样的“灵光一闪”，极大地增强了伙伴感。

---

## 4. 详细 UX/UI 设计规范

### 4.1 记忆中心仪表盘 (Dashboard)

**入口**：全局导航栏右上角“🧠 记忆中心”图标。

**布局**：
1. **概览区 (Stats)**：
   - 🧠 记忆条目：128 条
   - 📅 记忆跨度：2023.10 - 至今
   - ⚡️ 活跃话题：电影、编程、旅行

2. **核心记忆流 (Memory Stream)**：
   - 类似社交媒体的时间轴，展示 AI 最近“学会”的新知识。
   - 例：“刚刚学会了你喜欢喝冰美式 (来源：Session #1024)”

### 4.2 设置与隐私控制

**隐私模式 (Incognito Mode)**：
- 开关开启后，AI 停止写入新的长期记忆（summary/episodic），仅保留当前短期上下文。
- 关闭会话后，数据彻底不落盘。

**遗忘机制 (Forgetting)**：
1. **精准遗忘**：删除某条“喜欢吃辣”的记忆，不影响其他。
2. **会话遗忘**：删除整个会话，关联的摘要和情节索引同步物理删除（Cascade Delete）。
3. **核弹级遗忘 (Nuclear Option)**：“重置我的所有记忆”。二次确认 + 密码验证。

### 4.3 提示与反馈

**写入提示**：
- 当 AI 检测到重要信息并写入 mem0 时，左下角微提示：“已记住偏好”。

**召回高亮**：
- 对话气泡中，AI 引用的记忆内容使用虚线下划线样式。
- 鼠标悬停显示：“来源于 2024年1月15日 的对话”。

---

## 5. 接口与数据一致性标准

为了支撑上述产品体验，后端必须保证**数据一致性**。

### 5.1 删除一致性 (Consistency)
当用户执行“删除会话”操作时，系统必须在一个事务（或 Saga）中清除：
1. **Raw Messages** (`messages` 表)
2. **Context Summary** (`conversation_summaries` 表)
3. **Vector Indices** (`conversation_episodes` 向量库)
4. **Long-term Facts** (关联的 `mem0` 条目)

**API 设计建议**：
```http
POST /api/v1/memory/forget
{
  "scope": "conversation",
  "target_id": "uuid-123",
  "cascade_delete": true
}
```

### 5.2 状态透明性 (Observability)
前端需要知道记忆服务的状态：
- **Indexing Status**：当前是否正在生成摘要或索引？（显示“记忆整理中...”）
- **Health**：向量数据库是否在线？

---

## 6. 演进路线图 (Roadmap)

| 阶段 | 目标 | 关键特性 | 状态 |
|------|------|---------|------|
| **V1.0** | **基础底座** | 摘要生成、情节索引、基础设置开关 | ✅ 已完成 (Phase 1-3) |
| **V1.1** | **透明化** | “记忆中心”面板，查看已生成的摘要和画像 | 🚧 设计中 |
| **V1.2** | **可控化** | 逐条编辑/删除记忆，隐私模式 | 📅 规划中 |
| **V2.0** | **多模态** | 记住用户发送的图片、文档偏好 | 📅 远期规划 |

---

## 7. 行业案例对标 (Industry Benchmarks)

本设计参考了以下行业经典应用的记忆产品形态：

### 7.1 OpenAI ChatGPT (Memory)
- **形态**：设置页独立入口 "Manage Memory"。
- **设计**：用户可查看 AI 记住的具体事实（如“女儿喜欢水母”），并支持逐条删除或一键清空。
- **对标点**：我们的 **“3.1 我的画像”** 板块直接对标此功能，提供透明的长期记忆管理。

### 7.2 Character.ai (Pinned Memories)
- **形态**：聊天界面内的 "Pinned Messages"（图钉功能）。
- **设计**：允许用户手动固定最多 15 条关键消息，确保 AI 永远记得设定。
- **对标点**：我们的 **“3.2 对话资产”** 中的“关键回顾”与此呼应，但我们更进一步，通过后台自动摘要来通过“滑窗”限制，而不单纯依赖用户手动固定。

### 7.3 MemGPT / Mem0 (Developer Tools)
- **形态**：核心记忆区 (Core Memory) + 归档记忆区 (Archival Memory) 的可视化面板。
- **设计**：将记忆分为“人设/画像”（RAM）和“历史事件”（Disk），提供观察窗口。
- **对标点**：本设计的 **三层架构 (Profile/Summary/Episodic)** 正是这一理念的 C 端产品化落地。

---

---

## 9. 产品创新实验室 (Innovation Lab)

为了打造差异化竞争力，我们可以在标准功能之上，探索以下 **"Wow Moment"** 创新点：

### 9.1 可视化记忆图谱 (Memory Graph)
- **概念**：打破列表式的枯燥展示，用 **知识图谱 (Knowledge Graph)** 的形式可视化用户画像。
- **形态**：一个动态的宇宙星云视图。核心已确认的画像（如“程序员”）是恒星，周边的偏好（如“Python”）是行星，一次性对话产生的临时记忆是流星。
- **价值**：极具科技感和视觉冲击力，直观展示 AI 对用户理解的“深度”和“广度”。

### 9.2 记忆反思日报 (Memory Reflection)
- **概念**：模仿人类的“日记”或“复盘”机制。
- **形态**：AI 主动生成的周报/日报。“本周我们聊了 3 次，我发现你对 *Web3* 产生了兴趣，同时你似乎很焦虑 *项目上线*。为此我调整了我的回复风格为 *更鼓励性*。”
- **价值**：将隐性的“参数调整”显性化为“情感关怀”，极大幅度提升用户的被重视感。

### 9.3 "假如遗忘"模拟器 (What-If Simulator)
- **概念**：让用户直观感受某条记忆的价值。
- **形态**：在单条记忆（如“喜欢诺兰电影”）旁提供一个“测试”按钮。点击后，AI 会弹出对比演示：“如果我记得这条，我会推荐《星际穿越》；如果我忘了这条，我会推荐《泰坦尼克号》”。
- **价值**：用最直观的方式教育用户“为什么保留记忆对你有好处”，增加用户删除记忆的心理门槛。

---

## 10. MVP 交付清单 (Minimum Viable Product)

为了快速上线并验证价值，建议第一阶段 (V1.0) 聚焦于 **“可见性”** 和 **“基础控制”**。

### 10.1 前端功能 (Frontend)
- [ ] **入口**：TopBar 增加“🎬”图标。
- [ ] **口味标签 (Profile)**：
    - 展示 "Genre: Sci-Fi", "Director: Nolan" 等标签云。
    - 支持点击标签跳转到相关推荐。
- [ ] **观影资产 (Watch History)**：
    - **Session Recap**：顶部展示上一次讨论的电影（如《盗梦空间》海报 + 核心结论）。
    - **Watchlist**：侧边栏展示由对话自动提取的“待看清单”。
- [ ] **基础控制**：
    - **语义遗忘**：支持“忘掉我看过《这个杀手不太冷》”（以便重刷）。
    - **全局重置**：彻底清空所有观影记录和偏好。

### 10.2 后端能力 (Backend)
- [ ] **API**: `GET /api/v1/memory/taste_profile` (获取结构化的观影偏好，兼容 mem0)。
- [ ] **API**: `GET /api/v1/memory/watchlist` (获取从对话中提取的待看列表)。
- [ ] **API**: `POST /api/v1/memory/forget` (支持 `scope=movie` 语义删除)。
- [ ] **Consistency**: 确保删除电影记录时，同步清除相关的情节摘要。

### 10.3 用户控制 (User Control) - MVP Essential
- [ ] **Incognito Toggle (隐私模式)**：
    - Chat Header 增加 "Incognito Mode" (无痕模式) 开关。
    - 开启时：
        - 不触发 Summarization。
        - 不触发 Episodic Memory Indexing。
        - 不触发 Watchlist Auto-Capture。
        - 不写入 mem0。
    - 关闭会话后无痕迹。
- [ ] **Auto-Capture Toggle (自动捕获开关)**：
    - 允许用户全局关闭 "Watchlist 自动捕获"，避免被打扰。
- [ ] **Notification & Undo**:
    - 自动捕获时提供 Toast 通知，并支持 "Undo" (撤销) 操作。

### 10.4 暂不包含 (Post-MVP)
- [ ] 逐条编辑/锁定记忆。
- [ ] 记忆图谱/可视化。
- [ ] "假如遗忘"模拟器。
